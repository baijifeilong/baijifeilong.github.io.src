---
title: MySQL大杂烩
categories:
  - Programming
  - SQL
tags:
  - Programming
  - SQL
  - MySQL
date: 2018-10-04 01:26:17
---

## 1. 触发器

举个栗子：数据表`person`中有个字段叫`updated`，记录更新次数。初始为0，每次更新数据都加1

```sql
DROP TRIGGER IF EXISTS my_trigger;
CREATE TRIGGER my_trigger
  BEFORE UPDATE
  ON person
  FOR EACH ROW
  BEGIN
    SET NEW.updated = OLD.updated + 1;
  END;
```

OLD保存旧数据，NEW保存新数据

注意：更新NEW只能使用BEFORE触发器

## 2. 允许多查询

通过MySQl驱动执行SQL时，有时需要一次执行多条SQL。默认情况是不支持的，需要手动开启。以JDBC为例：

`jdbc:mysql://localhost:3306/foo?allowMultiQueries=true`

这里的多查询，不是特指`SELECT`。任意语句都可。

## 3. 日期格式化

`SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%S')`

结果

`2018-06-28 11:40:10`

## 4. MySQL的一些特殊用法

- 当计算器使用 `SELECT 8 * 8`
- 查看当前日期时间 `SELECT CURRENT_TIMESTAMP`
- 计算三角函数 `SELECT SIN(30 / 180 * PI())`
- 计算MD5 `SELECT MD5('password')`
- 生成UUID `SELECT UUID()`
- 查ASCII码 `SELECT ASCII('A')`
- 查二进制 `SELECT BIN(1024)`
- 查十六进制 `SELECT HEX(1024)`
- 获取随机数 `SELECT RAND()`
- 日期计算 `SELECT ADDDATE(NOW(), INTERVAL -18 YEAR)`
- 分支 `SELECT CASE 12345 WHEN 1 THEN 'ONE' ELSE 'NOT ONE' END`
- 赌大小 `SELECT IF(random.number > 0.5, 'BIG', 'SMALL') FROM (SELECT RAND() AS number) AS random` 或 `SELECT IF(RAND() > 0.5, 'BIG', 'SMALL');`
